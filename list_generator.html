<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Lector de Excel a Lista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
    <style>
        body {
            background-color: #f0f0ff;
        }

        .container {
            background-color: #ffffff;
        }

        .text-primary {
            color: #6a1a8c !important;
        }

        .btn-success {
            background-color: #8a2be2;
            border-color: #8a2be2;
        }

        .btn-success:hover {
            background-color: #7a1ba2;
            border-color: #7a1ba2;
        }

        .btn-primary {
            background-color: #8a2be2;
            border-color: #8a2be2;
        }

        .btn-primary:hover {
            background-color: #7a1ba2;
            border-color: #7a1ba2;
        }

        h1,
        h4 {
            color: #8a2be2;
        }

        .text-dark-emphasis {
            color: #6a1a8c !important;
        }

        .form-label,
        .btn-outline-secondary {
            color: #6a1a8c;
        }

        /* Nuevo estilo para la lista con scroll */
        .scroll-list-container {
            max-height: 400px;
            /* Ajusta la altura m치xima seg칰n lo necesites */
            overflow-y: auto;
            /* Permite el desplazamiento vertical cuando el contenido es demasiado largo */
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container mt-5 p-4 bg-white shadow rounded">
        <h1 class="mb-4 text-primary text-center">Gestor de Archivos Excel y Creador de Documentos</h1>
        <div class="mb-3">
            <label class="form-label fw-bold">Seleccionar archivo Excel:</label>
            <input type="file" id="inputExcel" accept=".xlsx" class="form-control">
        </div>
        <div class="row g-3 mb-3">
            <div class="col-md-3">
                <label class="form-label fw-bold">Opciones:</label><br>
                <button class="btn btn-outline-secondary w-100" onclick="ordenarLista()">Ordenar
                    alfab칠ticamente</button>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Fuente:</label>
                <select id="fuente" class="form-select">
                    <option value="helvetica" selected>Helvetica</option>
                    <option value="times">Times</option>
                    <option value="courier">Courier</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Tama침o de letra:</label>
                <input type="number" id="tamano" class="form-control" value="12" min="8" max="30">
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Nombre del archivo:</label>
                <input type="text" id="nombreArchivo" class="form-control" value="lista_nombres">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label fw-bold">T칤tulo (opcional):</label>
            <input type="text" id="titulo" class="form-control" placeholder="Escribe un t칤tulo para la lista">
        </div>
        <div class="mb-4 spa">
            <button class="btn btn-success me-2" onclick="exportPDF()">游늯 Exportar a PDF</button>
            <button class="btn btn-primary" onclick="exportWord()">游닇 Exportar a Word</button>
        </div>
        <h4 class="fw-bold">游늶 Lista de nombres completos:</h4>
        <div class="scroll-list-container">
            <ol id="lista" class="mt-3"></ol>
        </div>
    </div>
    <script>
        let nombresLimpios = [];
        document.getElementById('inputExcel').addEventListener('change', handleFile);

        function handleFile(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function (event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                nombresLimpios = [];
                workbook.SheetNames.forEach(sheetName => {
                    const worksheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    json.forEach(row => {
                        const filaUnida = row
                            .map(cell => (cell ? String(cell).replace(/\s+/g, " ").trim() : ""))
                            .filter(cell => cell.length > 0)
                            .join(" ");
                        if (filaUnida.length > 0) {
                            nombresLimpios.push(filaUnida);
                        }
                    });
                });
                mostrarLista();
            };
            reader.readAsArrayBuffer(file);
        }

        function mostrarLista() {
            const lista = document.getElementById("lista");
            lista.innerHTML = "";
            nombresLimpios.forEach((nombre, index) => {
                const li = document.createElement("li");
                li.textContent = nombre;
                lista.appendChild(li);
            });
        }

        function ordenarLista() {
            nombresLimpios.sort((a, b) => a.localeCompare(b));
            mostrarLista();
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const fuente = document.getElementById("fuente").value;
            const tamano = parseInt(document.getElementById("tamano").value);
            const titulo = document.getElementById("titulo").value.trim();
            const nombreArchivo = document.getElementById("nombreArchivo").value.trim() || "lista_nombres";

            doc.setFont(fuente, "normal");
            doc.setFontSize(tamano);
            let y = 15;
            if (titulo.length > 0) {
                doc.setFont(fuente, "bold");
                doc.text(titulo, 10, y);
                doc.setFont(fuente, "normal");
                y += 10;
            }
            nombresLimpios.forEach((nombre, i) => {
                doc.text(`${i + 1}. ${nombre}`, 10, y);
                y += 10;
                if (y > 280) {
                    doc.addPage();
                    y = 15;
                }
            });
            doc.save(nombreArchivo + ".pdf");
        }

        async function exportWord() {
            const fuente = document.getElementById("fuente").value;
            const tamano = parseInt(document.getElementById("tamano").value);
            const titulo = document.getElementById("titulo").value.trim();
            const nombreArchivo = document.getElementById("nombreArchivo").value.trim() || "lista_nombres";

            let htmlContent = '';
            const tamanoDocx = tamano * 2;
            const fuenteDocx = (fuente === 'helvetica' ? 'Arial' : fuente === 'times' ? 'Times New Roman' : 'Courier New');

            if (titulo.length > 0) {
                htmlContent += `<h1 style="font-family: '${fuenteDocx}'; font-size: ${tamanoDocx}pt; font-weight: bold;">${titulo}</h1>`;
            }

            htmlContent += '<ol>';
            nombresLimpios.forEach((nombre) => {
                htmlContent += `<li style="font-family: '${fuenteDocx}'; font-size: ${tamanoDocx}pt;">${nombre}</li>`;
            });
            htmlContent += '</ol>';

            const blob = htmlDocx.asBlob(htmlContent);

            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = nombreArchivo + ".docx";
            link.click();
        }

          // Si el usuario no ha iniciado sesi칩n, redirige a la p치gina de inicio.
        // La ruta '../Inicio.html' asume que Menu_Principal.html est치 en una subcarpeta (ej. 'Herramientas').
        if (sessionStorage.getItem("isLoggedIn") !== "true") {
            window.location.replace('Inicio.html');
        }

        // Esta funci칩n se activar치 al hacer clic en "Cerrar sesi칩n"
        function cerrarSesion() {
            sessionStorage.removeItem("isLoggedIn");
            window.location.replace('Inicio.html');
        }
    </script>
</body>

</html>